<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="index_files/new.css">
<title>CS 280 - Programming Assignment #1</title>
<style>
body {
   background : #ffffff; 
   margin-left : 40;
   margin-right : 10;
   background : url("../../../../../images/notebook.jpg");
   }
</style><style>
  .vt-augment {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .vt-augment.drawer {
    display: none;
    width: 700px;
    background: white;
    border: 1px solid #e6e6e6;
    text-align: left;
    z-index: 102;
    position: fixed;
    right: 0;
    top: 0;
    height: 100vh;
    box-shadow: -4px 5px 8px -3px rgba(17, 17, 17, .16);
    animation: slideToRight 0.5s 1 forwards;
    transform: translateX(100vw);
  }
  .vt-augment.drawer[opened] {
    display: flex;
    animation: slideFromRight 0.2s 1 forwards;
  }
  .vt-augment > .spinner {
    position: absolute;
    z-index: 199;
    top: calc(50% - 50px);
    left: calc(50% - 50px);
    border: 8px solid rgba(0, 0, 0, 0.2);
    border-left-color: white;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1.2s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  @keyframes slideFromRight {
    0% {
      transform: translateX(100vw);
    }
    100% {
      transform: translateX(0);
    }
  }
  @keyframes slideToRight {
    100% {
      transform: translateX(100vw);
      display: none;
    }
  }
  @media screen and (max-width: 700px) {
    .vt-augment.drawer {
      width: 100%;
    }
  }
</style></head>



<body>  
<center>
<h1>CS 280 - Programming Assignment #1</h1>
(ObjectAllocator)
</center>

<!--********************************************************************************************-->
<!--********************************************************************************************-->
<!--********************************************************************************************-->
<p class="SectionHeader">
Information
</p>

<ul>
<li><a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/cs280-programming-assignment-object-allocator.pdf">Handout</a> 
  You <b>MUST</b> read this before starting the assignment.</li>
<li>Interface: <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/ObjectAllocator.h.html">HTML</a> <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/ObjectAllocator.h">Text</a>

  <!--
  <blockquote>
  <b>The Doxygen documentation has changed!</b> Make sure you understand that. There is a
    Doxyfile posted on the main web page that you should use for this and all other
    assignments.</li>
    </blockquote>
  -->

</li><li>Sample driver program: <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/driver-sample.cpp.html">HTML</a> <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/driver-sample.cpp">Text</a> 
</li><li>Random number generator
<ul>
	<li>Interface: <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/PRNG.h.html">HTML</a> <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/PRNG.h">Text</a>  
	</li><li>Implementation: <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/PRNG.cpp.html">HTML</a> <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/PRNG.cpp">Text</a>  
</li></ul>

</li><li>Sample command lines for compiling: 
	
<ul>
<li>GNU g++: 
<pre><b>g++</b> -o gnu driver-sample.cpp ObjectAllocator.cpp PRNG.cpp -O2 -Werror -Wall -Wextra -Wconversion <font color="blue"><b>-std=c++17</b></font> -pedantic
</pre>

Running under Valgrind in Linux, macOS (or whatever it's called this year), or WSL:
<pre><b>valgrind</b> -q --leak-check=full --show-reachable=yes --tool=memcheck ./gnu 
</pre>

<!--
<p>
<li>Microsoft: (<font color="red"><b>Not required for grading</b></font>)
<pre>
<b>cl</b> -Fems driver-sample.cpp ObjectAllocator.cpp PRNG.cpp /EHsc /Oy- /Ob0 /MT /Zi /D_CRT_SECURE_NO_DEPRECATE
</pre>
To check your program for memory leaks and hidden bugs with Dr. Memory, you must make sure that these
options are specified with Microsoft's compiler
(<a href="http://drmemory.org/docs/page_prep.html">reference</a>):
<pre>
/Zi /MT /EHsc /Oy- /Ob0 
</pre>
Then running it like this:
<pre>
<b>drmemory</b> -batch -brief -- ms.exe
</pre>
If your program is clean, you should see all zeros for the output:

<pre>
~~Dr.M~~
~~Dr.M~~ NO ERRORS FOUND:
~~Dr.M~~       0 unique,     0 total unaddressable access(es)
~~Dr.M~~       0 unique,     0 total uninitialized access(es)
~~Dr.M~~       0 unique,     0 total invalid heap argument(s)
~~Dr.M~~       0 unique,     0 total GDI usage error(s)
~~Dr.M~~       0 unique,     0 total handle leak(s)
~~Dr.M~~       0 unique,     0 total warning(s)
~~Dr.M~~       0 unique,     0 total,      0 byte(s) of leak(s)
~~Dr.M~~       0 unique,     0 total,      0 byte(s) of possible leak(s)
</pre>

If any errors are found, Dr. Memory will show them and tell you the filenames and line numbers
in the call stack:
<pre>
~~Dr.M~~
~~Dr.M~~ Error #1: UNADDRESSABLE ACCESS: writing 4 byte(s)
~~Dr.M~~ # 0 replace_memset                      [d:\drmemory_package\drmemory\replace.c:182]
~~Dr.M~~ # 1 ObjectAllocator::Free               [objectallocator.cpp:247]
~~Dr.M~~ # 2 DoEmployees                         [driver.cpp:1206]
~~Dr.M~~ # 3 ExecuteTest                         [driver.cpp:2245]
~~Dr.M~~ # 4 main                                [driver.cpp:2304]
~~Dr.M~~ Note: refers to 0 byte(s) beyond last valid byte in prior malloc
~~Dr.M~~
~~Dr.M~~ Error #2: UNADDRESSABLE ACCESS: writing 4 byte(s)
~~Dr.M~~ # 0 ObjectAllocator::push_front               [objectallocator.cpp:617]
~~Dr.M~~ # 1 ObjectAllocator::Free                     [objectallocator.cpp:251]
~~Dr.M~~ # 2 DoEmployees                               [driver.cpp:1206]
~~Dr.M~~ # 3 ExecuteTest                               [driver.cpp:2245]
~~Dr.M~~ # 4 main                                      [driver.cpp:2304]
~~Dr.M~~ Note: refers to 0 byte(s) beyond last valid byte in prior malloc
~~Dr.M~~ WARNING: application exited with abnormal code 0xffffffff  
</pre>

-->

</li></ul>   


</li><li>64-bit output:</li>
  <ul>
    <li>64-bit (LP64):
     <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/output-sample-zeros-LP64.txt">Generic (no addresses)</a> &nbsp;
    </li>
  </ul>
<li>64-bit output with extra credit:</li>
  <ul>
    <li>64-bit (LP64):
     <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/output-sample-zeros-ec-LP64.txt">Generic (no addresses)</a> &nbsp;
   </li>
  </ul>
<p>

<!--
<li>32-bit output:</li>
  <ul>
    <li>32-bit (ILP32):
     <a href="output-sample-zeros-ILP32.txt">Generic (no addresses)</a> &nbsp;
    </li>
  </ul>
<li>32-bit utput with extra credit:</li>
  <ul>
    <li>32-bit (ILP32):
     <a href="output-sample-zeros-ec-ILP32.txt">Generic (no addresses)</a> &nbsp;
   </li>
  </ul>
<p>
-->

</p><li><a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/CS280/ObjectAllocatorIndex.html">Diagrams</a> to help you understand the implementation.
</li><li><a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/CS280-FAQ1.html">FAQ</a> for this assignment.
<!--
<li><a href="http://gcc.gnu.org/onlinedocs/libstdc++/manual/bk01pt08ch19s02.html">One Past the End</a> 
	This is a refresher on the C/C++ concept of pointing/dereferencing an element "one past the end" of an array. 
	Going more than one past the end is <b>undefined</b>. Don't do it. 
-->
<p>
</p></li></ul>

<!--********************************************************************************************-->
<!--********************************************************************************************-->
<!--********************************************************************************************-->
<p class="SectionHeader">
Other Criteria
</p>

<ul>
<li>You must use <b>new</b> and <b>delete</b> to allocate/deallocate the pages.</li>
<ul>
  <li>Do not use <tt><b>std::nothrow</b></tt> with <tt><b>new</b></tt>. (If you don't know what that is, you're probably not going to use it.)</li>
  <li>You must catch the exception (<tt><b>std::bad_alloc</b></tt>) that is thrown from <tt><b>new</b></tt>.</li>
</ul>
<li>You can't use any STL code in your implementation (with the exception of <tt><b>std::string</b></tt> for exception messages).
<!--<li>You can use anything you want (STL, malloc, MFC, BCB, VB, Perl, Python, Ruby) to code a driver program to test your implementation.-->
</li><li>You can't change the <b>public</b> interface at all. 
</li><li>Given this struct:

<blockquote><pre><b>struct</b> Student
{
  <b>int</b> Age;   
  <b>float</b> GPA; 
  <b>long</b> Year; 
  <b>long</b> ID;   
};
</pre></blockquote>

<b><tt>sizeof</tt></b><tt>(Student)</tt> returns:
<blockquote>
<pre> LLP64: 16
  LP64: 24
</pre>
</blockquote>
</li>
<li>DO NOT assume that pointers, integers, and long integers are the same size. Doing so may cause the compiler
  to emit warnings and can also lead to your program crashing.
  See <a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/docs/sizes2.c.html">this</a> for a quick refresher.</li>

<p>
<!--
<li>Adjusting for Microsoft's odd compiler:
<blockquote><pre>
<b>struct</b> Student
{
  <b>int</b> Age;   
  <b>float</b> GPA; 
  <b>long</b> Year; 
  <b>long</b> ID;   
};
</pre></blockquote>

<b><tt>sizeof</b>(Student)</tt> now returns:
<blockquote>
<pre>
 LLP64: 24
  LP64: 24
</pre>
</blockquote>

</li>
-->

</p><li>Using the GenericObject structure. Assume that FreeList_ and PageList_ are each pointers to a
  GenericObject:

<blockquote><pre>GenericObject *PageList_; <font color="#003399"><i>//!&lt; the beginning of the list of pages</i></font>
GenericObject *FreeList_; <font color="#003399"><i>//!&lt; the beginning of the list of objects</i></font>
</pre></blockquote>

Freeing a block by putting it back on the free list (at the front of the list):

<blockquote><pre>  <font color="#003399"><i>// Put block on front of the free list. FreeList currently points to the</i></font>
  <font color="#003399"><i>// front of the free list. block is an address of a block of memory that</i></font>
  <font color="#003399"><i>// was used by the client, e.g. a Student object. When the client returns</i></font>
  <font color="#003399"><i>// the block by calling Free(block), you would need to put the block</i></font>
  <font color="#003399"><i>// at the front of the free list. The Free function takes a void pointer</i></font>
  <font color="#003399"><i>// so it must be cast so that there is a next pointer.</i></font>
GenericObject *temp = <b>reinterpret_cast</b>&lt;GenericObject *&gt;(block);
temp-&gt;Next = FreeList_;
FreeList_ = temp;
</pre></blockquote>

The code above would probably be in some kind of loop that would execute <i>X</i> times, where
<i>X</i> is the number of objects (blocks) per page. Assuming that <i>block</i> is a simple pointer
to a character, the next block would be something like:
<blockquote><pre>block += size_of_object; <font color="#003399"><i>// Find the next block in the page</i></font>
</pre></blockquote>

and you would then put that on the front of the free list. Having helper functions will greatly simplify
the work. If you look at this code while looking at the diagrams that I posted, you should get a
better insight into how this should work.

<blockquote><pre></pre></blockquote>

<blockquote><pre></pre></blockquote>

<blockquote><pre></pre></blockquote>

<p>

Walking the PageList_ and freeing all of the pages. Since each page was allocated as an array of
characters, you have to cast it back so that it can be deleted properly. 

</p><blockquote><pre><b>while</b> (PageList_)
{
  GenericObject *temp = PageList_-&gt;Next;
  <b>delete</b> [] <b>reinterpret_cast</b>&lt;<b>char</b> *&gt;(PageList_);
  PageList_ = temp;
}
</pre></blockquote>

In your own programs, you can make your pagelist and freelist either GenericObject pointers or
char pointers. When you're trying to access the Next member, you will have to cast a character
pointer to a GenericObject pointer. When you're trying to do pointer arithmetic on the page,
you will have to cast a GenericObject pointer to a character pointer.
<p>
In either situtation, you
will require a cast, so it really doesn't matter which way you go. However, DO NOT use void pointers
as you will then need to cast every operation on the pointer because you can't do much with
a void pointer (i.e. you can't dereference it, you can't do pointer arithmetic, you can't delete
it, etc.)

</p><blockquote><pre></pre></blockquote>

<blockquote><pre></pre></blockquote>

<blockquote><pre></pre></blockquote>

<blockquote><pre></pre></blockquote>

<blockquote><pre></pre></blockquote>



</li></ul>

<!--********************************************************************************************-->
<!--********************************************************************************************-->
<!--********************************************************************************************-->
<p class="SectionHeader">
Exception Handling Examples</p>

<p>
Please note that these are <i>examples</i>! Your code will probably be different.
</p><p>

</p><pre class="sourcecode"><code>
  <font color="#003399"><i>// Make sure this object hasn't been freed yet</i></font>
<b>if</b> (is_on_freelist(anObject))
  <b>throw</b> OAException(OAException::E_MULTIPLE_FREE, <font color="#9933CC">"FreeObject: Object has already been freed."</font>);


  <font color="#003399"><i>// If new throws an exception, catch it, and throw our own type of exception</i></font>
<b>char</b> *newpage;
<b>try</b>
{
  newpage = <b>new</b> <b>char</b>[PageSize_];
}
<b>catch</b> (std::bad_alloc &amp;)
{
  <b>throw</b> OAException(OAException::E_NO_MEMORY, <font color="#9933CC">"allocate_new_page: No system memory available."</font>);
}

<b>if</b> ( <font color="#003399"><i>/* Object is on a valid page boundary */</i></font> )
  <font color="#003399"><i>// put it on the free list</i></font>
<b>else</b>
  <b>throw</b> OAException(OAException::E_BAD_BOUNDARY, <font color="#9933CC">"validate_object: Object not on a boundary."</font>);


</code></pre>

<a href="https://distance3.sg.digipen.edu/2023sg-spring/pluginfile.php/54761/mod_resource/content/1/ObjectAllocator/azrael.digipen.edu/~mmead/www/Courses/2021/summer/cs280/project1-objectallocator/OATestGUI-pages.exe">Download the GUI executable</a> This is an older version (doesn't include all 
of the header block functionality) that
includes the more sophisticated "hex viewer" component on the Page list tab.
<!--
<p>
<a href="OATestGUI-simple.exe">Newer version</a> This is the latest version, but uses a simpler component
to dump the memory (much like the text driver). If you download the source above, this is the program
is the result of building it.
-->
<br><br><br><br>






<blockquote><pre></pre></blockquote>

<div>
    <div class="vtResetstyles">
    <div id="vtoverlay" class="vtoverlay vthidden w3-animate-right
    w3-container">
    <div class="vtmain vthidden" id="vtmain">
      <div class="vtcontactus">
          <a id="linktest" href="https://www.virustotal.com/">
            <img class="vtlogo-popup" style=" width: 32px; 
            height: 32px;" src="index_files/vt-logo.svg">
          </a>
          <a href="https://www.virustotal.com/">VT4Browsers
          </a>
      </div>
      <span id="vtclose"><strong>X</strong></span>
      <div class="vttextpopup vthidden" id="statustext">
        <div class="vtscanstatus" id="vtscanstatus"></div>
        <div class="vtprogress vthidden" id="vtprogress"></div>
        <br id="brfile">
        <div class="vtscanstatus" id="vtscanfilelink"></div>
      </div>
      <div class="vttextpopup vthidden" id="widgettext">
        <div id="vtwidgetError"></div>
      </div>
    </div>
    </div>
    </div>
    <div id="vt-augment-container" class="vtzindex vt-augment drawer" style="background: rgb(49, 61, 90);"></div></div><span class="vttooltiptext vthidden">&nbsp;Click to open VirusTotal report&nbsp;<br>with VT Augment</span><style></style></body></html>